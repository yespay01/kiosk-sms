<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>키오스크 - 알림톡 대기표</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        .header h1 {
            color: white;
            font-size: 3rem;
            margin-bottom: 30px;
        }
        
        .main-btn {
            background: #00b894;
            color: white;
            border: none;
            padding: 40px 60px;
            border-radius: 20px;
            font-size: 2rem;
            cursor: pointer;
            margin-bottom: 30px;
        }
        
        .main-btn:active {
            background: #00a085;
        }

        /* 팝업 */
        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }
        
        .popup.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .popup-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
        }
        
        .popup h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #333;
        }
        
        .phone-display {
            font-size: 2rem;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 10px;
            margin-bottom: 20px;
            font-family: monospace;
        }
        
        .number-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .num-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 20px;
            font-size: 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            min-height: 60px;
        }
        
        .num-btn:active {
            background: #2980b9;
        }
        
        .delete-btn {
            background: #e74c3c;
        }
        
        .clear-btn {
            background: #f39c12;
            font-size: 1rem;
        }
        
        .close-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .course-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .course-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 30px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        .course-btn:active {
            background: #5a6fd8;
        }
        
        .success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #00b894;
            color: white;
            padding: 30px;
            border-radius: 15px;
            font-size: 1.5rem;
            z-index: 2000;
            display: none;
        }
        
        .success.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📱 알림톡 대기표</h1>
        </div>
        
        <button class="main-btn" onclick="showPhonePopup()">
            대기표 발급하기
        </button>
    </div>

    <!-- 핸드폰 번호 팝업 -->
    <div class="popup" id="phonePopup">
        <div class="popup-content">
            <h2>핸드폰 번호 입력</h2>
            <div class="phone-display" id="phoneDisplay">010-</div>
            
            <div class="number-pad">
                <button class="num-btn" onclick="addNum('1')">1</button>
                <button class="num-btn" onclick="addNum('2')">2</button>
                <button class="num-btn" onclick="addNum('3')">3</button>
                <button class="num-btn" onclick="addNum('4')">4</button>
                <button class="num-btn" onclick="addNum('5')">5</button>
                <button class="num-btn" onclick="addNum('6')">6</button>
                <button class="num-btn" onclick="addNum('7')">7</button>
                <button class="num-btn" onclick="addNum('8')">8</button>
                <button class="num-btn" onclick="addNum('9')">9</button>
                <button class="num-btn delete-btn" onclick="deleteNum()">←</button>
                <button class="num-btn" onclick="addNum('0')">0</button>
                <button class="num-btn clear-btn" onclick="clearNum()">전체삭제</button>
            </div>
            
            <button class="close-btn" onclick="closePhonePopup()">취소</button>
        </div>
    </div>

    <!-- 과정 선택 팝업 -->
    <div class="popup" id="coursePopup">
        <div class="popup-content">
            <h2>과정 선택</h2>
            <div class="phone-display" id="selectedPhone">010-1234-5678</div>
            
            <div class="course-grid">
                <button class="course-btn" onclick="selectCourse('중국어 과정')">중국어 과정</button>
                <button class="course-btn" onclick="selectCourse('영어 과정')">영어 과정</button>
                <button class="course-btn" onclick="selectCourse('HSK 시험반')">HSK 시험반</button>
                <button class="course-btn" onclick="selectCourse('TOEIC 집중반')">TOEIC 집중반</button>
            </div>
            
            <button class="close-btn" onclick="closeCoursePopup()">돌아가기</button>
        </div>
    </div>

    <!-- 성공 메시지 -->
    <div class="success" id="successMsg">
        <div id="successText">대기표 발급 완료!</div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCNhcSqZgtSS63QTmjWtiMxgy5g8soOzho",
            authDomain: "alimtalk-waiting-ticket.firebaseapp.com",
            databaseURL: "https://alimtalk-waiting-ticket-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "alimtalk-waiting-ticket",
            storageBucket: "alimtalk-waiting-ticket.firebasestorage.app",
            messagingSenderId: "313045604729",
            appId: "1:313045604729:web:2599fe60cad2b573bc37a8"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        window.firebaseDB = database;
        window.firebaseRef = ref;
        window.firebaseSet = set;
    </script>

    <script>
        let phoneNumber = '';
        let currentNumbers = { CH: 0, EN: 0, HSK: 0, TO: 0 };

        // 팝업 열기
        function showPhonePopup() {
            phoneNumber = '';
            updatePhoneDisplay();
            document.getElementById('phonePopup').classList.add('show');
        }

        // 팝업 닫기
        function closePhonePopup() {
            document.getElementById('phonePopup').classList.remove('show');
        }

        function closeCoursePopup() {
            document.getElementById('coursePopup').classList.remove('show');
        }

        // 번호 추가
        function addNum(num) {
            console.log('번호 추가:', num);
            if (phoneNumber.length < 11) {
                phoneNumber += num;
                updatePhoneDisplay();
                
                if (phoneNumber.length === 11) {
                    setTimeout(() => {
                        closePhonePopup();
                        showCoursePopup();
                    }, 300);
                }
            }
        }

        // 번호 삭제
        function deleteNum() {
            console.log('번호 삭제');
            if (phoneNumber.length > 0) {
                phoneNumber = phoneNumber.slice(0, -1);
                updatePhoneDisplay();
            }
        }

        // 전체 삭제
        function clearNum() {
            console.log('전체 삭제');
            phoneNumber = '';
            updatePhoneDisplay();
        }

        // 화면 업데이트
        function updatePhoneDisplay() {
            const display = document.getElementById('phoneDisplay');
            
            if (phoneNumber.length === 0) {
                display.textContent = '010-';
            } else if (phoneNumber.length <= 3) {
                display.textContent = '010-' + phoneNumber;
            } else if (phoneNumber.length <= 7) {
                display.textContent = '010-' + phoneNumber.substring(0, 4) + '-' + phoneNumber.substring(4);
            } else {
                display.textContent = '010-' + phoneNumber.substring(0, 4) + '-' + phoneNumber.substring(4, 8);
            }
        }

        // 과정 선택 팝업
        function showCoursePopup() {
            const formatted = '010-' + phoneNumber.substring(0, 4) + '-' + phoneNumber.substring(4);
            document.getElementById('selectedPhone').textContent = formatted;
            document.getElementById('coursePopup').classList.add('show');
        }

        // 과정 선택
        function selectCourse(courseName) {
            console.log('과정 선택:', courseName);
            
            // 과정 코드 매핑
            const courseCode = {
                '중국어 과정': 'CH',
                '영어 과정': 'EN', 
                'HSK 시험반': 'HSK',
                'TOEIC 집중반': 'TO'
            }[courseName];
            
            // 번호 생성
            currentNumbers[courseCode]++;
            const ticketNumber = courseCode + currentNumbers[courseCode].toString().padStart(3, '0');
            
            // Firebase 저장
            const ticketData = {
                number: ticketNumber,
                course: courseName,
                phoneNumber: '010' + phoneNumber,
                time: new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' }),
                timestamp: new Date().toISOString()
            };
            
            // 시스템에 추가
            if (!window.systemData) {
                window.systemData = { waiting: [], totalToday: 0 };
            }
            
            window.systemData.waiting.push(ticketData);
            window.systemData.totalToday++;
            
            // Firebase 저장
            if (window.firebaseDB) {
                const systemRef = window.firebaseRef(window.firebaseDB, 'counterSystem');
                window.firebaseSet(systemRef, window.systemData);
            }
            
            // 성공 메시지
            showSuccess(ticketNumber, courseName);
            closeCoursePopup();
        }

        // 성공 메시지
        function showSuccess(ticketNumber, courseName) {
            const successEl = document.getElementById('successMsg');
            const textEl = document.getElementById('successText');
            
            textEl.innerHTML = `
                <div style="font-size: 2rem; margin-bottom: 10px;">${ticketNumber}</div>
                <div>📱 알림톡 대기표 발급 완료!</div>
                <div style="font-size: 1rem; margin-top: 10px;">${courseName}</div>
            `;
            
            successEl.classList.add('show');
            
            setTimeout(() => {
                successEl.classList.remove('show');
            }, 3000);
        }

        console.log('✅ 간단 키오스크 로드 완료');
    </script>
</body>
</html>
